{"version":3,"sources":["assets\\Script\\mainController.js"],"names":["Emitter","require","cc","Class","Component","properties","goAttackFlag","goLeftFlag","goRightFlag","goJumpFlag","counter","frames","limitX","mainItem","Node","mainItemSkeleton","sp","Skeleton","footstepSound","AudioSource","attackSound","onLoad","instance","registerEvent","goAttack","bind","goLeft","goRight","goJump","resetPos","setEventListener","entry","event","data","log","name","play","start","update","dt","checkMove","limitPos","disableButton","disableKey","resetMove","setAnimation","addAnimation","spawn","moveBy","scaleTo","runAction","sequence","callFunc","moveTo","rotateTo","value","emit","x"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Emitter = require(\"mEmitter\");\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    goAttackFlag: false,\r\n    goLeftFlag: false,\r\n    goRightFlag: false,\r\n    goJumpFlag: false,\r\n    counter: 0,\r\n    frames: 40,\r\n    limitX: 377,\r\n    mainItem: cc.Node,\r\n    mainItemSkeleton: sp.Skeleton,\r\n    footstepSound: cc.AudioSource,\r\n    attackSound: cc.AudioSource,\r\n  },\r\n  // LIFE-CYCLE CALLBACKS:\r\n  onLoad() {\r\n    Emitter.instance = new Emitter();\r\n    Emitter.instance.registerEvent(\"ATTACK\", this.goAttack.bind(this));\r\n    Emitter.instance.registerEvent(\"LEFT\", this.goLeft.bind(this));\r\n    Emitter.instance.registerEvent(\"RIGHT\", this.goRight.bind(this));\r\n    Emitter.instance.registerEvent(\"JUMP\", this.goJump.bind(this));\r\n    Emitter.instance.registerEvent(\"RESET\", this.resetPos.bind(this));\r\n\r\n    this.mainItemSkeleton.setEventListener((entry, event) => {\r\n      const { data } = event;\r\n      cc.log(data.name);\r\n      if ((data.name = \"footstep\")) {\r\n        this.footstepSound.play();\r\n      }\r\n    });\r\n  },\r\n  start() {},\r\n  update(dt) {\r\n    this.checkMove();\r\n    this.limitPos();\r\n  },\r\n  checkMove() {\r\n    if (\r\n      this.goAttack ||\r\n      this.goLeftFlag ||\r\n      this.goRightFlag ||\r\n      this.goJumpFlag\r\n    ) {\r\n      if (this.counter >= this.frames) {\r\n        this.disableButton(true);\r\n        this.disableKey(true);\r\n        this.resetMove();\r\n        return;\r\n      }\r\n      this.disableButton(false);\r\n      this.disableKey(false);\r\n      this.counter++;\r\n    }\r\n  },\r\n  goAttack() {\r\n    this.goAttackFlag = true;\r\n    this.counter = 0;\r\n    this.mainItemSkeleton.setAnimation(0, \"shoot\", false);\r\n    this.mainItemSkeleton.addAnimation(0, \"idle\", false);\r\n    this.attackSound.play();\r\n  },\r\n  goLeft() {\r\n    this.goLeftFlag = true;\r\n    this.counter = 0;\r\n    let goLeft = cc.spawn(cc.moveBy(0.5, -80, 0), cc.scaleTo(0, -0.3, 0.3));\r\n    this.mainItem.runAction(goLeft);\r\n    this.mainItemSkeleton.setAnimation(0, \"walk\", false);\r\n    this.mainItemSkeleton.addAnimation(0, \"idle\", false);\r\n  },\r\n  goRight() {\r\n    this.goRightFlag = true;\r\n    this.counter = 0;\r\n    let goRight = cc.spawn(cc.moveBy(0.5, +80, 0), cc.scaleTo(0, 0.3, 0.3));\r\n    this.mainItem.runAction(goRight);\r\n    this.mainItemSkeleton.setAnimation(0, \"walk\", false);\r\n    this.mainItemSkeleton.addAnimation(0, \"idle\", false);\r\n  },\r\n  goJump() {\r\n    this.goJumpFlag = true;\r\n    this.counter = 0;\r\n\r\n    let goJump = cc.sequence(\r\n      cc.callFunc(() => {\r\n        this.mainItemSkeleton.setAnimation(0, \"jump\", false);\r\n        this.mainItemSkeleton.addAnimation(0, \"idle\", false);\r\n      }),\r\n      cc.moveBy(0.5, 0, +120),\r\n      cc.moveBy(0.5, 0, -120)\r\n    );\r\n    this.mainItem.runAction(goJump);\r\n  },\r\n  resetPos() {\r\n    let resetPos = cc.spawn(\r\n      cc.moveTo(0, 0, -200),\r\n      cc.scaleTo(0, 0.3, 0.3),\r\n      cc.rotateTo(0, 0)\r\n    );\r\n    this.mainItem.runAction(resetPos);\r\n\r\n    this.mainItemSkeleton.setAnimation(0, \"idle\", false);\r\n  },\r\n  resetMove() {\r\n    this.goAttackFlag = false;\r\n    this.goLeftFlag = false;\r\n    this.goRightFlag = false;\r\n    this.goJumpFlag = false;\r\n  },\r\n  disableButton(value) {\r\n    Emitter.instance.emit(\"DISABLE BUTTON\", value);\r\n  },\r\n  disableKey(value) {\r\n    Emitter.instance.emit(\"DISABLE KEY\", value);\r\n  },\r\n  limitPos() {\r\n    if (this.mainItem.x <= -this.limitX) {\r\n      this.mainItem.x = -this.limitX;\r\n    } else if (this.mainItem.x >= this.limitX) {\r\n      this.mainItem.x = this.limitX;\r\n    }\r\n  },\r\n});\r\n"]}
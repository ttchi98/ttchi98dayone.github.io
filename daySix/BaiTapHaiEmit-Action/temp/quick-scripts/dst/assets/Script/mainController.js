
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/mainController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9dffegMTbdFA7rfltJFTQ5S', 'mainController');
// Script/mainController.js

"use strict";

var Emitter = require("mEmitter");

cc.Class({
  "extends": cc.Component,
  properties: {
    goAttackFlag: false,
    goLeftFlag: false,
    goRightFlag: false,
    goJumpFlag: false,
    counter: 0,
    frames: 40,
    limitX: 377,
    mainItem: cc.Node,
    mainItemSkeleton: sp.Skeleton,
    footstepSound: cc.AudioSource,
    attackSound: cc.AudioSource
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    var _this = this;

    Emitter.instance = new Emitter();
    Emitter.instance.registerEvent("ATTACK", this.goAttack.bind(this));
    Emitter.instance.registerEvent("LEFT", this.goLeft.bind(this));
    Emitter.instance.registerEvent("RIGHT", this.goRight.bind(this));
    Emitter.instance.registerEvent("JUMP", this.goJump.bind(this));
    Emitter.instance.registerEvent("RESET", this.resetPos.bind(this));
    this.mainItemSkeleton.setEventListener(function (entry, event) {
      var data = event.data;
      cc.log(data.name);

      if (data.name = "footstep") {
        _this.footstepSound.play();
      }
    });
  },
  start: function start() {},
  update: function update(dt) {
    this.checkMove();
    this.limitPos();
  },
  checkMove: function checkMove() {
    if (this.goAttack || this.goLeftFlag || this.goRightFlag || this.goJumpFlag) {
      if (this.counter >= this.frames) {
        this.disableButton(true);
        this.disableKey(true);
        this.resetMove();
        return;
      }

      this.disableButton(false);
      this.disableKey(false);
      this.counter++;
    }
  },
  goAttack: function goAttack() {
    this.goAttackFlag = true;
    this.counter = 0;
    this.mainItemSkeleton.setAnimation(0, "shoot", false);
    this.mainItemSkeleton.addAnimation(0, "idle", false);
    this.attackSound.play();
  },
  goLeft: function goLeft() {
    this.goLeftFlag = true;
    this.counter = 0;
    var goLeft = cc.spawn(cc.moveBy(0.5, -80, 0), cc.scaleTo(0, -0.3, 0.3));
    this.mainItem.runAction(goLeft);
    this.mainItemSkeleton.setAnimation(0, "walk", false);
    this.mainItemSkeleton.addAnimation(0, "idle", false);
  },
  goRight: function goRight() {
    this.goRightFlag = true;
    this.counter = 0;
    var goRight = cc.spawn(cc.moveBy(0.5, +80, 0), cc.scaleTo(0, 0.3, 0.3));
    this.mainItem.runAction(goRight);
    this.mainItemSkeleton.setAnimation(0, "walk", false);
    this.mainItemSkeleton.addAnimation(0, "idle", false);
  },
  goJump: function goJump() {
    var _this2 = this;

    this.goJumpFlag = true;
    this.counter = 0;
    var goJump = cc.sequence(cc.callFunc(function () {
      _this2.mainItemSkeleton.setAnimation(0, "jump", false);

      _this2.mainItemSkeleton.addAnimation(0, "idle", false);
    }), cc.moveBy(0.5, 0, +120), cc.moveBy(0.5, 0, -120));
    this.mainItem.runAction(goJump);
  },
  resetPos: function resetPos() {
    var resetPos = cc.spawn(cc.moveTo(0, 0, -200), cc.scaleTo(0, 0.3, 0.3), cc.rotateTo(0, 0));
    this.mainItem.runAction(resetPos);
    this.mainItemSkeleton.setAnimation(0, "idle", false);
  },
  resetMove: function resetMove() {
    this.goAttackFlag = false;
    this.goLeftFlag = false;
    this.goRightFlag = false;
    this.goJumpFlag = false;
  },
  disableButton: function disableButton(value) {
    Emitter.instance.emit("DISABLE BUTTON", value);
  },
  disableKey: function disableKey(value) {
    Emitter.instance.emit("DISABLE KEY", value);
  },
  limitPos: function limitPos() {
    if (this.mainItem.x <= -this.limitX) {
      this.mainItem.x = -this.limitX;
    } else if (this.mainItem.x >= this.limitX) {
      this.mainItem.x = this.limitX;
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxtYWluQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyIiwicmVxdWlyZSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiZ29BdHRhY2tGbGFnIiwiZ29MZWZ0RmxhZyIsImdvUmlnaHRGbGFnIiwiZ29KdW1wRmxhZyIsImNvdW50ZXIiLCJmcmFtZXMiLCJsaW1pdFgiLCJtYWluSXRlbSIsIk5vZGUiLCJtYWluSXRlbVNrZWxldG9uIiwic3AiLCJTa2VsZXRvbiIsImZvb3RzdGVwU291bmQiLCJBdWRpb1NvdXJjZSIsImF0dGFja1NvdW5kIiwib25Mb2FkIiwiaW5zdGFuY2UiLCJyZWdpc3RlckV2ZW50IiwiZ29BdHRhY2siLCJiaW5kIiwiZ29MZWZ0IiwiZ29SaWdodCIsImdvSnVtcCIsInJlc2V0UG9zIiwic2V0RXZlbnRMaXN0ZW5lciIsImVudHJ5IiwiZXZlbnQiLCJkYXRhIiwibG9nIiwibmFtZSIsInBsYXkiLCJzdGFydCIsInVwZGF0ZSIsImR0IiwiY2hlY2tNb3ZlIiwibGltaXRQb3MiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZUtleSIsInJlc2V0TW92ZSIsInNldEFuaW1hdGlvbiIsImFkZEFuaW1hdGlvbiIsInNwYXduIiwibW92ZUJ5Iiwic2NhbGVUbyIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwiY2FsbEZ1bmMiLCJtb3ZlVG8iLCJyb3RhdGVUbyIsInZhbHVlIiwiZW1pdCIsIngiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUF2Qjs7QUFDQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDUCxhQUFTRCxFQUFFLENBQUNFLFNBREw7QUFFUEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLElBQUFBLFlBQVksRUFBRSxLQURKO0FBRVZDLElBQUFBLFVBQVUsRUFBRSxLQUZGO0FBR1ZDLElBQUFBLFdBQVcs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QW1DLENBQW5DLEVBQXNDLE1BQXRDLEVBQThDLEtBQTlDO0FBQ0QsR0FyR007QUFzR1BELEVBQUFBLFNBdEdPLHVCQXNHSztBQUNWLFNBQUt0QyxZQUFMLEdBQW9CLEtBQXBCO0FBQ0EsU0FBS0MsVUFBTCxHQUFrQixLQUFsQjtBQUNBLFNBQUtDLFdBQUwsR0FBbUIsS0FBbkI7QUFDQSxTQUFLQyxVQUFMLEdBQWtCLEtBQWxCO0FBQ0QsR0EzR007QUE0R1BpQyxFQUFBQSxhQTVHTyx5QkE0R09hLEtBNUdQLEVBNEdjO0FBQ25CdkQsSUFBQUEsT0FBTyxDQUFDc0IsUUFBUixDQUFpQmtDLElBQWpCLENBQXNCLGdCQUF0QixFQUF3Q0QsS0FBeEM7QUFDRCxHQTlHTTtBQStHUFosRUFBQUEsVUEvR08sc0JBK0dJWSxLQS9HSixFQStHVztBQUNoQnZELElBQUFBLE9BQU8sQ0FBQ3NCLFFBQVIsQ0FBaUJrQyxJQUFqQixDQUFzQixhQUF0QixFQUFxQ0QsS0FBckM7QUFDRCxHQWpITTtBQWtIUGQsRUFBQUEsUUFsSE8sc0JBa0hJO0FBQ1QsUUFBSSxLQUFLNUIsUUFBTCxDQUFjNEMsQ0FBZCxJQUFtQixDQUFDLEtBQUs3QyxNQUE3QixFQUFxQztBQUNuQyxXQUFLQyxRQUFMLENBQWM0QyxDQUFkLEdBQWtCLENBQUMsS0FBSzdDLE1BQXhCO0FBQ0QsS0FGRCxNQUVPLElBQUksS0FBS0MsUUFBTCxDQUFjNEMsQ0FBZCxJQUFtQixLQUFLN0MsTUFBNUIsRUFBb0M7QUFDekMsV0FBS0MsUUFBTCxDQUFjNEMsQ0FBZCxHQUFrQixLQUFLN0MsTUFBdkI7QUFDRDtBQUNGO0FBeEhNLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEVtaXR0ZXIgPSByZXF1aXJlKFwibUVtaXR0ZXJcIik7XHJcbmNjLkNsYXNzKHtcclxuICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcbiAgcHJvcGVydGllczoge1xyXG4gICAgZ29BdHRhY2tGbGFnOiBmYWxzZSxcclxuICAgIGdvTGVmdEZsYWc6IGZhbHNlLFxyXG4gICAgZ29SaWdodEZsYWc6IGZhbHNlLFxyXG4gICAgZ29KdW1wRmxhZzogZmFsc2UsXHJcbiAgICBjb3VudGVyOiAwLFxyXG4gICAgZnJhbWVzOiA0MCxcclxuICAgIGxpbWl0WDogMzc3LFxyXG4gICAgbWFpbkl0ZW06IGNjLk5vZGUsXHJcbiAgICBtYWluSXRlbVNrZWxldG9uOiBzcC5Ta2VsZXRvbixcclxuICAgIGZvb3RzdGVwU291bmQ6IGNjLkF1ZGlvU291cmNlLFxyXG4gICAgYXR0YWNrU291bmQ6IGNjLkF1ZGlvU291cmNlLFxyXG4gIH0sXHJcbiAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XHJcbiAgb25Mb2FkKCkge1xyXG4gICAgRW1pdHRlci5pbnN0YW5jZSA9IG5ldyBFbWl0dGVyKCk7XHJcbiAgICBFbWl0dGVyLmluc3RhbmNlLnJlZ2lzdGVyRXZlbnQoXCJBVFRBQ0tcIiwgdGhpcy5nb0F0dGFjay5iaW5kKHRoaXMpKTtcclxuICAgIEVtaXR0ZXIuaW5zdGFuY2UucmVnaXN0ZXJFdmVudChcIkxFRlRcIiwgdGhpcy5nb0xlZnQuYmluZCh0aGlzKSk7XHJcbiAgICBFbWl0dGVyLmluc3RhbmNlLnJlZ2lzdGVyRXZlbnQoXCJSSUdIVFwiLCB0aGlzLmdvUmlnaHQuYmluZCh0aGlzKSk7XHJcbiAgICBFbWl0dGVyLmluc3RhbmNlLnJlZ2lzdGVyRXZlbnQoXCJKVU1QXCIsIHRoaXMuZ29KdW1wLmJpbmQodGhpcykpO1xyXG4gICAgRW1pdHRlci5pbnN0YW5jZS5yZWdpc3RlckV2ZW50KFwiUkVTRVRcIiwgdGhpcy5yZXNldFBvcy5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICB0aGlzLm1haW5JdGVtU2tlbGV0b24uc2V0RXZlbnRMaXN0ZW5lcigoZW50cnksIGV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YSB9ID0gZXZlbnQ7XHJcbiAgICAgIGNjLmxvZyhkYXRhLm5hbWUpO1xyXG4gICAgICBpZiAoKGRhdGEubmFtZSA9IFwiZm9vdHN0ZXBcIikpIHtcclxuICAgICAgICB0aGlzLmZvb3RzdGVwU291bmQucGxheSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9LFxyXG4gIHN0YXJ0KCkge30sXHJcbiAgdXBkYXRlKGR0KSB7XHJcbiAgICB0aGlzLmNoZWNrTW92ZSgpO1xyXG4gICAgdGhpcy5saW1pdFBvcygpO1xyXG4gIH0sXHJcbiAgY2hlY2tNb3ZlKCkge1xyXG4gICAgaWYgKFxyXG4gICAgICB0aGlzLmdvQXR0YWNrIHx8XHJcbiAgICAgIHRoaXMuZ29MZWZ0RmxhZyB8fFxyXG4gICAgICB0aGlzLmdvUmlnaHRGbGFnIHx8XHJcbiAgICAgIHRoaXMuZ29KdW1wRmxhZ1xyXG4gICAgKSB7XHJcbiAgICAgIGlmICh0aGlzLmNvdW50ZXIgPj0gdGhpcy5mcmFtZXMpIHtcclxuICAgICAgICB0aGlzLmRpc2FibGVCdXR0b24odHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5kaXNhYmxlS2V5KHRydWUpO1xyXG4gICAgICAgIHRoaXMucmVzZXRNb3ZlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbihmYWxzZSk7XHJcbiAgICAgIHRoaXMuZGlzYWJsZUtleShmYWxzZSk7XHJcbiAgICAgIHRoaXMuY291bnRlcisrO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgZ29BdHRhY2soKSB7XHJcbiAgICB0aGlzLmdvQXR0YWNrRmxhZyA9IHRydWU7XHJcbiAgICB0aGlzLmNvdW50ZXIgPSAwO1xyXG4gICAgdGhpcy5tYWluSXRlbVNrZWxldG9uLnNldEFuaW1hdGlvbigwLCBcInNob290XCIsIGZhbHNlKTtcclxuICAgIHRoaXMubWFpbkl0ZW1Ta2VsZXRvbi5hZGRBbmltYXRpb24oMCwgXCJpZGxlXCIsIGZhbHNlKTtcclxuICAgIHRoaXMuYXR0YWNrU291bmQucGxheSgpO1xyXG4gIH0sXHJcbiAgZ29MZWZ0KCkge1xyXG4gICAgdGhpcy5nb0xlZnRGbGFnID0gdHJ1ZTtcclxuICAgIHRoaXMuY291bnRlciA9IDA7XHJcbiAgICBsZXQgZ29MZWZ0ID0gY2Muc3Bhd24oY2MubW92ZUJ5KDAuNSwgLTgwLCAwKSwgY2Muc2NhbGVUbygwLCAtMC4zLCAwLjMpKTtcclxuICAgIHRoaXMubWFpbkl0ZW0ucnVuQWN0aW9uKGdvTGVmdCk7XHJcbiAgICB0aGlzLm1haW5JdGVtU2tlbGV0b24uc2V0QW5pbWF0aW9uKDAsIFwid2Fsa1wiLCBmYWxzZSk7XHJcbiAgICB0aGlzLm1haW5JdGVtU2tlbGV0b24uYWRkQW5pbWF0aW9uKDAsIFwiaWRsZVwiLCBmYWxzZSk7XHJcbiAgfSxcclxuICBnb1JpZ2h0KCkge1xyXG4gICAgdGhpcy5nb1JpZ2h0RmxhZyA9IHRydWU7XHJcbiAgICB0aGlzLmNvdW50ZXIgPSAwO1xyXG4gICAgbGV0IGdvUmlnaHQgPSBjYy5zcGF3bihjYy5tb3ZlQnkoMC41LCArODAsIDApLCBjYy5zY2FsZVRvKDAsIDAuMywgMC4zKSk7XHJcbiAgICB0aGlzLm1haW5JdGVtLnJ1bkFjdGlvbihnb1JpZ2h0KTtcclxuICAgIHRoaXMubWFpbkl0ZW1Ta2VsZXRvbi5zZXRBbmltYXRpb24oMCwgXCJ3YWxrXCIsIGZhbHNlKTtcclxuICAgIHRoaXMubWFpbkl0ZW1Ta2VsZXRvbi5hZGRBbmltYXRpb24oMCwgXCJpZGxlXCIsIGZhbHNlKTtcclxuICB9LFxyXG4gIGdvSnVtcCgpIHtcclxuICAgIHRoaXMuZ29KdW1wRmxhZyA9IHRydWU7XHJcbiAgICB0aGlzLmNvdW50ZXIgPSAwO1xyXG5cclxuICAgIGxldCBnb0p1bXAgPSBjYy5zZXF1ZW5jZShcclxuICAgICAgY2MuY2FsbEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubWFpbkl0ZW1Ta2VsZXRvbi5zZXRBbmltYXRpb24oMCwgXCJqdW1wXCIsIGZhbHNlKTtcclxuICAgICAgICB0aGlzLm1haW5JdGVtU2tlbGV0b24uYWRkQW5pbWF0aW9uKDAsIFwiaWRsZVwiLCBmYWxzZSk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBjYy5tb3ZlQnkoMC41LCAwLCArMTIwKSxcclxuICAgICAgY2MubW92ZUJ5KDAuNSwgMCwgLTEyMClcclxuICAgICk7XHJcbiAgICB0aGlzLm1haW5JdGVtLnJ1bkFjdGlvbihnb0p1bXApO1xyXG4gIH0sXHJcbiAgcmVzZXRQb3MoKSB7XHJcbiAgICBsZXQgcmVzZXRQb3MgPSBjYy5zcGF3bihcclxuICAgICAgY2MubW92ZVRvKDAsIDAsIC0yMDApLFxyXG4gICAgICBjYy5zY2FsZVRvKDAsIDAuMywgMC4zKSxcclxuICAgICAgY2Mucm90YXRlVG8oMCwgMClcclxuICAgICk7XHJcbiAgICB0aGlzLm1haW5JdGVtLnJ1bkFjdGlvbihyZXNldFBvcyk7XHJcblxyXG4gICAgdGhpcy5tYWluSXRlbVNrZWxldG9uLnNldEFuaW1hdGlvbigwLCBcImlkbGVcIiwgZmFsc2UpO1xyXG4gIH0sXHJcbiAgcmVzZXRNb3ZlKCkge1xyXG4gICAgdGhpcy5nb0F0dGFja0ZsYWcgPSBmYWxzZTtcclxuICAgIHRoaXMuZ29MZWZ0RmxhZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5nb1JpZ2h0RmxhZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5nb0p1bXBGbGFnID0gZmFsc2U7XHJcbiAgfSxcclxuICBkaXNhYmxlQnV0dG9uKHZhbHVlKSB7XHJcbiAgICBFbWl0dGVyLmluc3RhbmNlLmVtaXQoXCJESVNBQkxFIEJVVFRPTlwiLCB2YWx1ZSk7XHJcbiAgfSxcclxuICBkaXNhYmxlS2V5KHZhbHVlKSB7XHJcbiAgICBFbWl0dGVyLmluc3RhbmNlLmVtaXQoXCJESVNBQkxFIEtFWVwiLCB2YWx1ZSk7XHJcbiAgfSxcclxuICBsaW1pdFBvcygpIHtcclxuICAgIGlmICh0aGlzLm1haW5JdGVtLnggPD0gLXRoaXMubGltaXRYKSB7XHJcbiAgICAgIHRoaXMubWFpbkl0ZW0ueCA9IC10aGlzLmxpbWl0WDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5tYWluSXRlbS54ID49IHRoaXMubGltaXRYKSB7XHJcbiAgICAgIHRoaXMubWFpbkl0ZW0ueCA9IHRoaXMubGltaXRYO1xyXG4gICAgfVxyXG4gIH0sXHJcbn0pO1xyXG4iXX0=
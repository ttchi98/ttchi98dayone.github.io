{"version":3,"sources":["objectB.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","timer","canMove","canJump","currentDirection","mainCharacterSp","sp","Skeleton","mainCharacter","Node","mainBackground","bulletPrefab","Prefab","attackSound","AudioSource","footstepSound","onLoad","addAnimation","manager","director","getCollisionManager","enabled","instance","registerEvent","goAttack_Action","bind","goLeft_Action","goRight_Action","goJump_Action","resetPos_Action","setEventListener","entry","event","data","name","play","start","update","dt","node","y","log","setAnimation","newBullet","instantiate","addChild","position","getPosition","scaleX","x","fireBullet","moveBy","runAction","goLeft","spawn","scaleTo","goRight","goJump","callFunc","resetPos","moveTo","rotateTo","onCollisionEnter","other","self","console","tag","onCollisionStay","onCollisionExit"],"mappings":"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","file":"objectB.js","sourceRoot":"../../../../assets/Script","sourcesContent":["const Emitter = require(\"mEmitter\");\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    timer: 0,\n    canMove: false,\n    canJump: false,\n    currentDirection: null,\n    mainCharacterSp: sp.Skeleton,\n    mainCharacter: cc.Node,\n    mainBackground: cc.Node,\n    bulletPrefab: cc.Prefab,\n    attackSound: cc.AudioSource,\n    footstepSound: cc.AudioSource,\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.mainCharacterSp.addAnimation(0, \"run\", true);\n\n    let manager = cc.director.getCollisionManager();\n    manager.enabled = true;\n    // manager.enabledDebugDraw = true;\n    Emitter.instance = new Emitter();\n\n    Emitter.instance.registerEvent(\n      \"ATTACK_ACTION\",\n      this.goAttack_Action.bind(this)\n    );\n    Emitter.instance.registerEvent(\n      \"LEFT_ACTION\",\n      this.goLeft_Action.bind(this)\n    );\n    Emitter.instance.registerEvent(\n      \"RIGHT_ACTION\",\n      this.goRight_Action.bind(this)\n    );\n    Emitter.instance.registerEvent(\n      \"JUMP_ACTION\",\n      this.goJump_Action.bind(this)\n    );\n    Emitter.instance.registerEvent(\n      \"RESET_ACTION\",\n      this.resetPos_Action.bind(this)\n    );\n    this.mainCharacterSp.setEventListener((entry, event) => {\n      const { data } = event;\n      if ((data.name = \"footstep\")) {\n        this.footstepSound.play();\n      }\n    });\n  },\n\n  start() {},\n\n  update(dt) {\n    if (this.node.y <= 270) {\n      this.node.y = 170;\n    }\n  },\n  goAttack_Action() {\n    cc.log(\"shoot\");\n    this.mainCharacterSp.setAnimation(0, \"shoot\", false);\n    this.attackSound.play();\n    let newBullet = cc.instantiate(this.bulletPrefab);\n    this.mainBackground.addChild(newBullet);\n    newBullet.position = this.mainCharacter.getPosition();\n    newBullet.y += 50;\n    if (this.mainCharacter.scaleX > 0) {\n      newBullet.scaleX = 0.12;\n      newBullet.x += 75;\n      let fireBullet = cc.moveBy(5, 3000, 0);\n      newBullet.runAction(fireBullet);\n    } else {\n      newBullet.x -= 75;\n      newBullet.scaleX = -0.12;\n      let fireBullet = cc.moveBy(5, -3000, 0);\n      newBullet.runAction(fireBullet);\n    }\n    this.mainCharacterSp.addAnimation(0, \"idle\", true);\n  },\n  goLeft_Action() {\n    let goLeft = cc.spawn(cc.moveBy(0.5, -150, 0), cc.scaleTo(0, -0.4, 0.4));\n    this.mainCharacter.runAction(goLeft);\n    this.mainCharacterSp.setAnimation(0, \"run\", true);\n  },\n  goRight_Action() {\n    let goRight = cc.spawn(cc.moveBy(0.5, +150, 0), cc.scaleTo(0, 0.4, 0.4));\n    this.mainCharacter.runAction(goRight);\n    this.mainCharacterSp.setAnimation(0, \"run\", true);\n  },\n  goJump_Action() {\n    if (this.mainCharacter.scaleX == -0.4) {\n      this.currentDirection = -250;\n    } else this.currentDirection = +250;\n    let goJump = cc.spawn(\n      cc.callFunc(() => {\n        this.mainCharacterSp.setAnimation(0, \"jump\", false);\n      }),\n      cc.moveBy(1, this.currentDirection, +150),\n      cc.moveBy(1.5, 0, -150),\n      cc.callFunc(() => {\n        this.mainCharacterSp.addAnimation(0, \"idle\", false);\n      })\n    );\n    this.mainCharacter.runAction(goJump);\n  },\n\n  resetPos_Action() {\n    let resetPos = cc.spawn(\n      cc.moveTo(0, -700, 170),\n      cc.scaleTo(0, 0.4, 0.4),\n      cc.rotateTo(0, 0)\n    );\n    this.mainCharacter.runAction(resetPos);\n\n    this.mainCharacterSp.setAnimation(0, \"idle\", false);\n  },\n  onCollisionEnter(other, self) {\n    console.log(\"on collision enter\");\n    if (self.tag === 0) this.goJump_Action();\n    if (other.tag === 0) this.goAttack_Action();\n  },\n\n  onCollisionStay(other, self) {\n    console.log(\"on collision stay\");\n  },\n  onCollisionExit(other, self) {\n    console.log(\"on collision exit\");\n    this.mainCharacterSp.setAnimation(0, \"idle\", false);\n  },\n});\n"]}